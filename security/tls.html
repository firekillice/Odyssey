<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTPS的那些事 | 吹风的坚果</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.280e3266.css" as="style"><link rel="preload" href="/assets/js/app.a58d46cf.js" as="script"><link rel="preload" href="/assets/js/2.fe1eedfa.js" as="script"><link rel="preload" href="/assets/js/6.2fd028ab.js" as="script"><link rel="prefetch" href="/assets/js/10.cfd8ec07.js"><link rel="prefetch" href="/assets/js/11.bfaecfdb.js"><link rel="prefetch" href="/assets/js/12.3d5b7b8a.js"><link rel="prefetch" href="/assets/js/13.ba32c4a8.js"><link rel="prefetch" href="/assets/js/14.20c0ad27.js"><link rel="prefetch" href="/assets/js/15.dd93f4bb.js"><link rel="prefetch" href="/assets/js/16.357888f8.js"><link rel="prefetch" href="/assets/js/17.c18c107c.js"><link rel="prefetch" href="/assets/js/18.dd58a776.js"><link rel="prefetch" href="/assets/js/19.cd2f9a46.js"><link rel="prefetch" href="/assets/js/20.0a808641.js"><link rel="prefetch" href="/assets/js/21.66e28aad.js"><link rel="prefetch" href="/assets/js/22.f5987e31.js"><link rel="prefetch" href="/assets/js/23.10b4c64e.js"><link rel="prefetch" href="/assets/js/24.b400c0b1.js"><link rel="prefetch" href="/assets/js/25.5eae1d63.js"><link rel="prefetch" href="/assets/js/26.f2235e62.js"><link rel="prefetch" href="/assets/js/27.4d4233f6.js"><link rel="prefetch" href="/assets/js/28.d311b5aa.js"><link rel="prefetch" href="/assets/js/29.cb91b13f.js"><link rel="prefetch" href="/assets/js/3.11390a21.js"><link rel="prefetch" href="/assets/js/4.748295fe.js"><link rel="prefetch" href="/assets/js/5.55b94567.js"><link rel="prefetch" href="/assets/js/7.12865be8.js"><link rel="prefetch" href="/assets/js/8.70384bac.js"><link rel="prefetch" href="/assets/js/9.fbfaf7b4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.280e3266.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">吹风的坚果</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/protocol/" class="nav-link">
  协议
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/insight/" class="nav-link">
  浅见
</a></div><div class="nav-item"><a href="/cncf/" class="nav-link">
  云原生
</a></div><div class="nav-item"><a href="/security/" class="nav-link router-link-active">
  安全
</a></div><div class="nav-item"><a href="/alg/" class="nav-link">
  算法
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/protocol/" class="nav-link">
  协议
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  读书
</a></div><div class="nav-item"><a href="/insight/" class="nav-link">
  浅见
</a></div><div class="nav-item"><a href="/cncf/" class="nav-link">
  云原生
</a></div><div class="nav-item"><a href="/security/" class="nav-link router-link-active">
  安全
</a></div><div class="nav-item"><a href="/alg/" class="nav-link">
  算法
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>安全</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/security/tls.html" aria-current="page" class="active sidebar-link">HTTPS的那些事</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/security/tls.html#网络是安全的么" class="sidebar-link">网络是安全的么</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#一步一步加固" class="sidebar-link">一步一步加固</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#对上述的流程的实现就是ssl-secure-sockets-layer-tls-transport-layer-security-协议" class="sidebar-link">对上述的流程的实现就是SSL(Secure Sockets Layer)/TLS(Transport Layer Security)协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/security/tls.html#tls协议的细节-基于tls1-2" class="sidebar-link">TLS协议的细节(基于TLS1.2)</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#证书的格式、处理、使用方式" class="sidebar-link">证书的格式、处理、使用方式</a></li></ul></li><li class="sidebar-sub-header"><a href="/security/tls.html#中间人攻击的几种类型" class="sidebar-link">中间人攻击的几种类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/security/tls.html#wi-fi仿冒" class="sidebar-link">Wi-Fi仿冒</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#arp欺骗" class="sidebar-link">ARP欺骗</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#dns欺骗" class="sidebar-link">DNS欺骗</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#ssl劫持" class="sidebar-link">SSL劫持</a></li></ul></li><li class="sidebar-sub-header"><a href="/security/tls.html#签名算法" class="sidebar-link">签名算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/security/tls.html#md5-message-digest-algorithm-5" class="sidebar-link">MD5(Message Digest Algorithm 5)</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#sha1-secure-hash-algorithm-1" class="sidebar-link">SHA1(Secure Hash Algorithm 1)</a></li></ul></li><li class="sidebar-sub-header"><a href="/security/tls.html#对称加密算法" class="sidebar-link">对称加密算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/security/tls.html#des-data-encryption-standard" class="sidebar-link">DES(Data Encryption Standard)</a></li><li class="sidebar-sub-header"><a href="/security/tls.html#_3des-triple-data-encryption-algorithm" class="sidebar-link">3DES(Triple Data Encryption Algorithm)</a></li></ul></li><li class="sidebar-sub-header"><a href="/security/tls.html#非对称加密算法" class="sidebar-link">非对称加密算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/security/tls.html#rsa-rivest-shamir-adleman" class="sidebar-link">RSA(Rivest–Shamir–Adleman)</a></li></ul></li><li class="sidebar-sub-header"><a href="/security/tls.html#reference" class="sidebar-link">reference</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="https的那些事"><a href="#https的那些事" class="header-anchor">#</a> HTTPS的那些事</h1> <p>本文先介绍了一下网络上的风险，然后一点一点分析如果将内容安全的包裹起来，结合抓包和TLS协议分析一下SSL协议的执行过程。后面又根据SSL中涉及的内容延伸介绍了证书使用、中间人攻击发生的情形、MD5、SHA1、DES、AES、RSA等算法</p> <h2 id="网络是安全的么"><a href="#网络是安全的么" class="header-anchor">#</a> 网络是安全的么</h2> <ul><li>随意列举网络相关的攻击方式
<ul><li>ARP欺骗: 谎报IP的MAC地址，有可能造成A的所有数据都被B机器接收了</li> <li>DNS劫持: 谎报域名的IP地址，将用户的请求指向了一个非法部署的机器上</li> <li>MITM(Man-in-the-Middle Attack)中间人攻击: 劫持并伪造会话</li> <li>重放攻击: 获取到曾经的合法数据，然后发送给系统</li> <li>XSS (Cross-Site Scripting，为了区分CSS): 跨站执行脚本</li> <li>CSRF(Cross-site request forgery)：跨站请求伪造</li></ul></li> <li>这里列举的仅仅是一部分，可以说在整个计算机体系大厦的各个角落都隐藏着想干坏事的狗蛋，我们今天呢，主要是分析HTTP协议的安全问题。HTTP协议如果只是传输一些文章、视频，那安全的意义并不大，或者说实施安全不划算，但是一旦涉及到敏感信息，比如账户信息、金钱信息，或者说交易场景，这个过程就需要进行特殊化处理，避免信息泄露或者恶意代码造成的损失。如何在一个不安全的环境中建立一个安全的通道用于数据传输呢？</li></ul> <h2 id="一步一步加固"><a href="#一步一步加固" class="header-anchor">#</a> 一步一步加固</h2> <ol><li>最简单的办法就是对称加密(后面的&quot;对称加密&quot;小节)，但是这个有个问题，两端必须<code>预知密码</code>，这个在很多场景下是做不到的。</li> <li>如果密码在网络上传输，如果密码被截获，有内容泄露的危险，怎么破???</li> <li>使用非对称加密(见后面的&quot;非对称加密&quot;小节)，将对称加密的密码通过非对称传输过去。那为什么不直接使用非对称传输呢，看看算法就知道了，非对称算法的计算量比对称加密多太多了，RSA的加解密是幂运算，而对称加解密基本都是最简单的亦或和偏移。</li> <li>问题又来了，如何保证公钥私钥的合法性呢？这里面可能有中间人攻击
<img src="/assets/img/middle-man-a.4b3e3265.png" alt="middle-man-a"></li> <li>如何保证公钥传输的安全性呢，找个<code>第三方机构</code>保存公钥，这就是所谓的<code>CA(Certificate Authority)</code>，数字证书认证机构生成并颁发认证,如何防止证书传输过程中被篡改呢，比如以下情形
<img src="/assets/img/middle-man-b.e935c551.png" alt="middle-man-b"></li> <li>加数字签名，防止中间人篡改，万无一失，最终证书的使用如下图所示
<img src="/assets/img/cert-use-layout.62899cd6.png" alt="cert-use-layout"></li></ol> <h2 id="对上述的流程的实现就是ssl-secure-sockets-layer-tls-transport-layer-security-协议"><a href="#对上述的流程的实现就是ssl-secure-sockets-layer-tls-transport-layer-security-协议" class="header-anchor">#</a> 对上述的流程的实现就是SSL(Secure Sockets Layer)/TLS(Transport Layer Security)协议</h2> <ul><li>When the SSL protocol was standardized by the IETF, it was renamed to Transport Layer Security (TLS).</li> <li>tsl其实是ssl的升级版, ssl 发展到ssl3.0就停止了，后面接着是tls, TLS 1.0通常被标示为SSL 3.1，TLS 1.1为SSL 3.2，TLS 1.2为SSL 3.3</li> <li>由于SSL位于应用层和传输层之间，所以可以为任何基于TCP等可靠连接的应用层协议提供安全性保证。</li></ul> <h3 id="tls协议的细节-基于tls1-2"><a href="#tls协议的细节-基于tls1-2" class="header-anchor">#</a> TLS协议的细节(基于TLS1.2)</h3> <ul><li>本文以ECDHE(Elliptic Curve Diffie–Hellman key Exchange)密钥交换算法为例，也可以使用RSA进行交换密钥</li></ul> <h4 id="通信步骤"><a href="#通信步骤" class="header-anchor">#</a> 通信步骤</h4> <ol><li>客户端发送<code>ClientHello</code>到服务器</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct {
    ProtocolVersion client_version;
    Random random;
    SessionID session_id;
    CipherSuite cipher_suites&lt;2..2^16-2&gt;;
    CompressionMethod compression_methods&lt;1..2^8-1&gt;;
    select (extensions_present) {
        case false:
            struct {};
        case true:
            Extension extensions&lt;0..2^16-1&gt;;
    };
} ClientHello;

struct {
    uint32 gmt_unix_time;
    opaque random_bytes[28];
} Random;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>random: 长度32bytes，由安全随机数字生成器生成；
cipher_suites: 降序排列的客户端支持的对称加密选项
<img src="/assets/img/tls-clienthello.17baa34f.png" alt="tls-clienthello"></p> <ol start="2"><li>服务器发送<code>ServerHello</code>到客户端</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct {
    ProtocolVersion server_version;
    Random random;
    SessionID session_id;
    CipherSuite cipher_suite;
    CompressionMethod compression_method;
    select (extensions_present) {
        case false:
            struct {};
        case true:
            Extension extensions&lt;0..2^16-1&gt;;
    };
} ServerHello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>random: 也是一个32bytes的随机值，不同的是，这个是服务器端独立生成的
cipher_suite: 服务器从客户端发送的列表中选出的一个
<img src="/assets/img/tls-serverhello.077c95be.png" alt="tls-serverhello">
从图中看到，服务器选择了<code>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</code>， 信息包括:</p> <ul><li>对称加密使用AES256</li> <li>密钥使用ECDHE进行交换</li> <li>签名使用SHA384</li></ul> <ol start="3"><li><p>服务器发送<code>Server Certificate</code> <code>struct { ASN.1Cert certificate_list&lt;0..2^24-1&gt;; } Certificate;</code> <img src="/assets/img/tls-certificate.60cade76.png" alt="tls-certificate">
可以看出几点: 数组形式发送, 证书是明文传输的、签名是加密过的</p></li> <li><p>服务器发送<code>ServerKeyExchange</code></p></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct {
    select (KeyExchangeAlgorithm) {
        case dh_anon:
            ServerDHParams params;
        case dhe_dss:
        case dhe_rsa:
            ServerDHParams params;
            digitally-signed struct {
                opaque client_random[32];
                opaque server_random[32];
                ServerDHParams params;
            } signed_params;
        case rsa:
        case dh_dss:
        case dh_rsa:
            struct {} ;
            /* message is omitted for rsa, dh_dss, and dh_rsa */
        /* may be extended, e.g., for ECDH -- see [TLSECC] */
    };
} ServerKeyExchange;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="data:image/png;base64,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" alt="tls-serverkeyexg"></p> <ol start="5"><li>服务器发送<code>ServerHelloDone</code></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct { } ServerHelloDone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="data:image/png;base64,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" alt="tls-serverhellodone"></p> <ol start="6"><li>客户端发送<code>ClientKeyExchange</code></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct {
  select (KeyExchangeAlgorithm) {
      case rsa:
          EncryptedPreMasterSecret;
      case dhe_dss:
      case dhe_rsa:
      case dh_dss:
      case dh_rsa:
      case dh_anon:
          ClientDiffieHellmanPublic;
  } exchange_keys;
} ClientKeyExchange;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="/assets/img/tls-clientkeyexg.be324af7.png" alt="tls-clientkeyexg"></p> <ol start="7"><li>客户端发送<code>ChangeCipherSpec</code></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct {
    enum { change_cipher_spec(1), (255) } type;
} ChangeCipherSpec;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="data:image/png;base64,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" alt="tsl-ChangeCipherSpec"></p> <ol start="8"><li>服务器发送<code>ChangeCipherSpec</code></li></ol> <h4 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h4> <ul><li>客户端和服务器发送<code>ChangeCipherSpec</code>后，CS就可以使用对称密钥进行通信了</li> <li>在ECDHE交换中，最终的会话密钥是ClientHello中的随机值和ServerHello的随机值，以及ServerKeyExchange和ClientKeyExchange算出的共享密钥，三个值计算而来的。在用RSA来交换共享密钥的时候，机制有所不同。但是最终的会话密钥都是以三个随机值共同计算而得的。</li></ul> <h3 id="证书的格式、处理、使用方式"><a href="#证书的格式、处理、使用方式" class="header-anchor">#</a> 证书的格式、处理、使用方式</h3> <ul><li>主要包括三个信息：颁发者的公钥、颁发者的基本信息到期时间等、签名</li></ul> <h4 id="最常见的信息格式x509"><a href="#最常见的信息格式x509" class="header-anchor">#</a> 最常见的信息格式X509</h4> <p>下文为Github网站的证书信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            06:3d:49:17:40:4d:39:e5:13:cb:3f:ee:cd:1b:2e:1b
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=US, O=DigiCert Inc, CN=DigiCert Global G2 TLS RSA SHA256 2020 CA1
        Validity
            Not Before: Mar 15 00:00:00 2024 GMT
            Not After : Mar 14 23:59:59 2025 GMT
        Subject: C=US, ST=California, L=San Francisco, O=GitHub, Inc., CN=*.github.io
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                Modulus:
                    00:ad:2b:14:a5:3a:4c:41:af:b8:b0:98:dd:93:ae:
                    5e:51:be:de:37:ab:0f:a1:0f:d6:07:35:a9:ed:f9:
                    ...
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Authority Key Identifier: 
                keyid:74:85:80:C0:66:C7:DF:37:DE:CF:BD:29:37:AA:03:1D:BE:ED:CD:17

            X509v3 Subject Key Identifier: 
                E8:6F:57:EB:86:51:98:EB:9F:A5:BE:53:DA:DB:94:AC:28:2E:FB:ED
            X509v3 Subject Alternative Name: 
                DNS:*.github.io, DNS:github.io, DNS:githubusercontent.com, DNS:www.github.com, DNS:*.github.com, DNS:*.githubusercontent.com, DNS:github.com
            X509v3 Certificate Policies: 
                Policy: 2.23.140.1.2.2
                  CPS: http://www.digicert.com/CPS

            X509v3 Key Usage: critical
                Digital Signature, Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication, TLS Web Client Authentication
            X509v3 CRL Distribution Points: 

                Full Name:
                  URI:http://crl3.digicert.com/DigiCertGlobalG2TLSRSASHA2562020CA1-1.crl

                Full Name:
                  URI:http://crl4.digicert.com/DigiCertGlobalG2TLSRSASHA2562020CA1-1.crl

            Authority Information Access: 
                OCSP - URI:http://ocsp.digicert.com
                CA Issuers - URI:http://cacerts.digicert.com/DigiCertGlobalG2TLSRSASHA2562020CA1-1.crt

            X509v3 Basic Constraints: critical
                CA:FALSE
            CT Precertificate SCTs: 
                Signed Certificate Timestamp:
                    Version   : v1(0)
                    Log ID    : 4E:75:A3:27:5C:9A:10:C3:38:5B:6C:D4:DF:3F:52:EB:
                                1D:F0:E0:8E:1B:8D:69:C0:B1:FA:64:B1:62:9A:39:DF
                    Timestamp : Mar 15 19:00:46.848 2024 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:45:02:20:53:F3:39:DB:B5:9C:C7:42:90:DC:82:3B:
                                90:2B:86:E5:63:2E:38:74:52:C4:A9:1F:D7:10:23:26:
                                E4:A4:C8:F0:02:21:00:95:5F:4B:AE:AD:C2:00:D9:48:
                                3B:8A:93:4D:D9:2D:59:CA:0B:A4:5A:A2:42:87:B8:63:
                                20:7D:17:B2:B5:E1:F1
                Signed Certificate Timestamp:
                    Version   : v1(0)
                    Log ID    : 7D:59:1E:12:E1:78:2A:7B:1C:61:67:7C:5E:FD:F8:D0:
                                87:5C:14:A0:4E:95:9E:B9:03:2F:D9:0E:8C:2E:79:B8
                    Timestamp : Mar 15 19:00:46.849 2024 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:45:02:20:0B:1A:4B:04:36:A4:F9:35:8A:6A:BA:C2:
                                1E:56:67:E0:39:6A:C0:47:C0:37:79:6F:96:04:A8:DB:
                                51:D0:B9:4F:02:21:00:E2:72:B6:FB:D9:CD:25:03:6B:
                                2E:31:63:D6:4F:DD:8F:14:B6:91:BC:5A:C5:9F:D1:D5:
                                CC:8E:95:87:9D:18:66
                Signed Certificate Timestamp:
                    Version   : v1(0)
                    Log ID    : E6:D2:31:63:40:77:8C:C1:10:41:06:D7:71:B9:CE:C1:
                                D2:40:F6:96:84:86:FB:BA:87:32:1D:FD:1E:37:8E:50
                    Timestamp : Mar 15 19:00:46.868 2024 GMT
                    Extensions: none
                    Signature : ecdsa-with-SHA256
                                30:46:02:21:00:F2:50:5F:84:00:AC:50:A3:33:4B:0A:
                                2B:3B:16:2E:6A:A6:99:4F:25:32:12:84:61:1D:93:81:
                                EB:35:01:0C:90:02:21:00:D9:8D:D5:84:FE:51:1B:E7:
                                5A:A5:C6:F0:62:05:5B:AD:39:60:5B:33:BB:28:4F:E5:
                                83:5C:75:D4:25:5C:CF:74
    Signature Algorithm: sha256WithRSAEncryption
         72:a5:bf:33:9b:24:1c:71:83:22:da:50:d0:84:15:fd:fb:98:
         d1:6c:52:d5:e6:69:6b:e4:99:c7:c8:b7:d5:7e:4d:9e:d0:9a:
         ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><p>可以看到<code>Signature Algorithm</code>签名信息位于最后</p> <ul><li>证书常见的存储编码格式
<ul><li>PEM（Privacy-Enhanced Mail）是一种基于文本的编码格式，用于存储和传输加密数据，示例如下</li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>-----BEGIN CERTIFICATE-----
MII...（Base64 编码的数据）...
-----END CERTIFICATE-----
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>CSR(Certificate Signing Request)格式</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>-----BEGIN CERTIFICATE REQUEST-----
MII...（Base64 编码的数据）...
-----END CERTIFICATE REQUEST-----
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>DER(Distinguished Encoding Rules)，二进制存储</li> <li>从PEM文件中查看证书的详细信息</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> openssl x509 -in github.io.crt -noout -text
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>使用openssl在格式之间进行转换</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>将PEM的证书转为DER格式
openssl x509 -in github.io.crt -outform der -out cert.der
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="浏览器内置certificate的使用"><a href="#浏览器内置certificate的使用" class="header-anchor">#</a> 浏览器内置certificate的使用</h4> <ul><li>浏览器会内置信任的根证书机构
<img src="/assets/img/20201016151935.f65621f6.png" alt="浏览器内置的证书机构"></li> <li>当浏览器收到一个网站的证书的时候(通常在tls的握手阶段)，认证过程如下:
<ol><li>首先浏览器会从内置的证书列表中索引，找到服务器下发证书对应的机构，如果没有找到，此时就会提示用户该证书是不是由权威机构颁发，是不可信任的。如果查到了对应的机构，则取出该机构颁发的公钥。</li> <li>用机构的公钥解密签名，然后验证证书签名的合法性。签名通过后，浏览器验证证书记录的网址是否和当前网址是一致的，不一致会提示用户。如果网址一致会检查证书有效期，证书过期了也会提示用户。这些都通过认证时，浏览器就可以安全使用证书中的网站公钥了。</li></ol></li></ul> <h4 id="操作系统内置certificate"><a href="#操作系统内置certificate" class="header-anchor">#</a> 操作系统内置certificate</h4> <ul><li>centos自带的证书信息在/etc/pki目录下</li></ul> <h2 id="中间人攻击的几种类型"><a href="#中间人攻击的几种类型" class="header-anchor">#</a> 中间人攻击的几种类型</h2> <h3 id="wi-fi仿冒"><a href="#wi-fi仿冒" class="header-anchor">#</a> Wi-Fi仿冒</h3> <ul><li>这种攻击是最简单、常用的一种中间人攻击方式。攻击者创建恶意Wi-Fi接入点，接入点名称一般与当前环境相关，例如某某餐厅，具有极大迷惑性，而且没有加密保护。当用户不小心接入恶意Wi-Fi后，用户后续所有的通信流量都将被攻击者截获，进而个人信息被窃取。</li></ul> <h3 id="arp欺骗"><a href="#arp欺骗" class="header-anchor">#</a> ARP欺骗</h3> <ul><li>发生在同一个局域网中，攻击者冒充网关对用户的ARP请求进行回应，当用户把数据都发给攻击者的机器后，用户所有的流量都到了攻击者的主机上。</li></ul> <h3 id="dns欺骗"><a href="#dns欺骗" class="header-anchor">#</a> DNS欺骗</h3> <ul><li>通过在用户主机上安装恶意软件，该软件能够截获用户的DNS请求，并将攻击者的机器IP返回给用户，然后所有的流量都到了攻击者的主机上</li></ul> <h3 id="ssl劫持"><a href="#ssl劫持" class="header-anchor">#</a> SSL劫持</h3> <ul><li>在访问中间提供给用户非法的证书，然后用户在浏览器会<code>提示不安全</code>，如果安全意识不高的话，点了确认就中招了。</li></ul> <h2 id="签名算法"><a href="#签名算法" class="header-anchor">#</a> 签名算法</h2> <p><img src="/assets/img/hash-function.aaf2830c.png" alt="hash-function"></p> <ul><li>散列值长度固定</li> <li>抗碰撞性，相同消息的结果一定相同，不相同消息的结果一定不同</li> <li>使用单向函数，计算结果不可逆</li> <li>计算速度不会因为消息长度而明显增长</li></ul> <h3 id="md5-message-digest-algorithm-5"><a href="#md5-message-digest-algorithm-5" class="header-anchor">#</a> MD5(Message Digest Algorithm 5)</h3> <ul><li>生成的是一个<code>128bit</code>的签名</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;test&quot; | md5sum 
d8e8fca2dc0f896fd7cb4cb0031ba249  -
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>已经宣布被破解，但是不是根据散列值推到原文，而是找到了两个相同散列值的消息</li></ul> <h4 id="算法步骤"><a href="#算法步骤" class="header-anchor">#</a> 算法步骤</h4> <ul><li>参考依据为<a href="https://en.wikipedia.org/wiki/MD5" target="_blank" rel="noopener noreferrer">wiki中的MD5伪代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>根据算法有下图 <img src="/assets/img/md5-layout.6523b051.png" alt="md5-layout"></li></ul> <h5 id="填充"><a href="#填充" class="header-anchor">#</a> 填充</h5> <ul><li>内容的长度必须为512bit(64B)的整数倍</li> <li>填充的第一个字节为1000,接着是多个0000，最后为64bit的原始内容长度</li></ul> <h5 id="分块"><a href="#分块" class="header-anchor">#</a> 分块</h5> <ul><li>分块单位512bit(64B)</li></ul> <h5 id="循环压缩"><a href="#循环压缩" class="header-anchor">#</a> 循环压缩</h5> <ul><li>每块都要如图所示进行64次的循环,不同的循环批次使用的公式不同
<ul><li>即<code>i 从0-63</code></li> <li>i: 0-15</li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f := (b and c) or ((not b) and d)
g := i
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>i: 16-31</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f := (d and b) or ((not d) and c)
g := (5×i + 1) mod 16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>i: 32-47</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f := b xor c xor d
g := (3×i + 5) mod 16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>i: 48-63</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f := c xor (b or (not d))
g := (7×i) mod 16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>每块循环的结果都会累加到最终结果上</li></ul> <h5 id="得出结果"><a href="#得出结果" class="header-anchor">#</a> 得出结果</h5> <ul><li>将128bit的值转为16进制的字符串，即图中的ABCD输出为字符串</li></ul> <h3 id="sha1-secure-hash-algorithm-1"><a href="#sha1-secure-hash-algorithm-1" class="header-anchor">#</a> SHA1(Secure Hash Algorithm 1)</h3> <ul><li>算法相对MD5来说更简单一些</li> <li>SHA-1可以生成一个被称为消息摘要的<code>160bit</code>（20字节）散列值，散列值通常的呈现形式为40个十六进制数。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;test&quot; | sha1sum 
4e1243bd22c66e76c2ba9eddc1f91394e57f9f83
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>2017年2月23日，Google公司宣布，他们与CWI Amsterdam合作创建了两个有着相同SHA-1值但内容不同的PDF文件，这代表SHA-1算法已被正式攻破。</li> <li>在安全证书，目前基本采用了SHA-256的签名，生成一个<code>256bit</code>的签名，比SHA1的160bit要安全很多</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>echo &quot;test&quot; | sha256sum 
f2ca1bb6c7e907d06dafe4687e579fce76b37e4e93b7605022da52e6ccc26fd2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="算法步骤-2"><a href="#算法步骤-2" class="header-anchor">#</a> 算法步骤</h4> <ul><li>参考依据为<a href="https://en.wikipedia.org/wiki/SHA-1" target="_blank" rel="noopener noreferrer">wiki中的SHA1伪代码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <img src="/assets/img/md5-layout.6523b051.png" alt="md5-layout"></li></ul> <h5 id="填充-2"><a href="#填充-2" class="header-anchor">#</a> 填充</h5> <ul><li>这一步和MD5使用的方式一样，填充的第一个字节为1000,接着是多个0000，最后为64bit的原始内容长度</li> <li>产生512bit整数倍的内容</li></ul> <h5 id="分块-2"><a href="#分块-2" class="header-anchor">#</a> 分块</h5> <ul><li>按照512bit分块</li></ul> <h6 id="针对每块的循环"><a href="#针对每块的循环" class="header-anchor">#</a> 针对每块的循环</h6> <ol><li>512bit先分为16个子块，每块32bit，记为<code>M</code>数组</li> <li>原地<code>变胖</code>扩展为80个字块，每块32bit，存储在<code>W</code>数组</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>当0≤i≤15, W[i] = M[i] , 
当16≤i≤79, W[i] = (W[i-3] ⊕ W[i-8]⊕ W[i-14]⊕ W[i-16]) &lt;&lt; 1, 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>进行80次循环
<ul><li>0-19次</li></ul></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f = (b and c) or ((not b) and d)
k = 0x5A827999
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>20-39次</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f = b xor c xor d
k = 0x6ED9EBA1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>40-59次</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f = (b and c) or (b and d) or (c and d) 
k = 0x8F1BBCDC
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>60-79次</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>f = b xor c xor d
k = 0xCA62C1D6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>每块循环的结果都会累加到最终结果上</li></ul> <h5 id="得出结果-2"><a href="#得出结果-2" class="header-anchor">#</a> 得出结果</h5> <ul><li>将160bit的值转为16进制的字符串，即图中的ABCDE输出为字符串</li></ul> <h2 id="对称加密算法"><a href="#对称加密算法" class="header-anchor">#</a> 对称加密算法</h2> <ul><li>最简单的对称加密 <code>A xor B xor B = A</code></li></ul> <h3 id="des-data-encryption-standard"><a href="#des-data-encryption-standard" class="header-anchor">#</a> DES(Data Encryption Standard)</h3> <ul><li>分组长度64bit，所以算法是以64bit为单位进行的</li> <li>密钥长度56bit</li> <li>执行同一个算法16遍，每次使用不同的密钥</li> <li>轮钥的生成过程如下
<img src="/assets/img/keys-generate.1aa3bbf2.png" alt="keys-generate"></li> <li>S盒子置换如下
<img src="/assets/img/des-sbox.073ceee8.png" alt="des-sbox"></li> <li>循环过程如下
<img src="/assets/img/des-layout.556bf49c.png" alt="des-layout"></li></ul> <h3 id="_3des-triple-data-encryption-algorithm"><a href="#_3des-triple-data-encryption-algorithm" class="header-anchor">#</a> 3DES(Triple Data Encryption Algorithm)</h3> <ul><li>执行三遍DES</li></ul> <h4 id="aes-advanced-encryption-standard"><a href="#aes-advanced-encryption-standard" class="header-anchor">#</a> AES(Advanced Encryption Standard)</h4> <ul><li>根据密钥长度不同分为 AES-128,AES-192,AES-256，加密轮数分别为10,12,14</li> <li>目前<code>事实上的对称加密标准</code></li> <li>量子计算机解码256位AES密码所需的时间仍然与传统计算机解码128位AES密码所需的时间相同。因此，AES-256被认为是<code>抗量子（英语：quantum resistant）</code>的。</li> <li>下面以AES-128为例进行分析
<ul><li>对明文以128bit进行分组，加密算法以128bit为单位</li> <li>循环执行加密过程10次，每次使用不同的密钥</li> <li>初始密钥长度也是128bit，4个32bit</li> <li><img src="/assets/img/aes-layout.0f62c086.png" alt="aes-layout"></li></ul></li></ul> <h2 id="非对称加密算法"><a href="#非对称加密算法" class="header-anchor">#</a> 非对称加密算法</h2> <h3 id="rsa-rivest-shamir-adleman"><a href="#rsa-rivest-shamir-adleman" class="header-anchor">#</a> RSA(Rivest–Shamir–Adleman)</h3> <ul><li>对极大整数做因数分解的难度决定了 RSA 算法的可靠性</li> <li>欧拉函数: 是小于等于n的正整数中与n互质的数的数目，又称φ函数</li></ul> <h4 id="生成步骤"><a href="#生成步骤" class="header-anchor">#</a> 生成步骤</h4> <ol><li>选择任意两个素数P, Q</li> <li>算得N=P * Q</li> <li>根据欧拉函数，算得 T = (P - 1) * (Q - 1)</li> <li>得到一个比T小且与T互斥的数 E</li> <li>求 (E * D) mod T = 1 中D的值</li> <li>得到公钥对为 (N, E)，私钥对为(N, D)</li> <li>加密明文M: C = Math.Pow(M, E) % N</li> <li>解密密文C: M = Math.Pow(M, D) % N</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>Math.Pow()方法只是示意，实际计算请使用BigInteger对应的方法
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="用到的知识点"><a href="#用到的知识点" class="header-anchor">#</a> 用到的知识点</h4> <ul><li>最大公约数，欧几里得算法(辗转相除法)</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> long GCD(long a, long b) =&gt; b == 0 ? a : GCD(b, a % b);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>欧拉函数</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>获得的是： 小于等于n的正整数中与n互质的数的数目，如果是两个素数P,Q的乘积，它的欧拉函数的值为(P-1)*(Q-1)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>拓展欧几里得算法，用来求出第5步的D值</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>    public static int ExtendedGCD(int a, int b, out int x, out int y)
    {
        int t, d;
        if (b == 0) { x = 1; y = 0; return a; }
        d = ExtendedGCD(b, a % b, out x, out y);
        t = x;
        x = y;
        y = t - a / b * y;
        return d;
    }
    D = ExtendedGCD(E, T, out int x, out int y);
    if (x &lt; 0)
    {
        int i = 1;
        while (true)
        {
            if (((1 + i * T) % E) == 0)
            {
                D = (1 + i * T) / E;
                y = i * (-1);
                break;
            }
            ++i;
        }
    }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><code>微信公众号为“吹风的坚果”，欢迎关注，定期更新优质的计算机文章。</code></p> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> reference</h2> <ul><li><a href="https://hpbn.co/transport-layer-security-tls/" target="_blank" rel="noopener noreferrer">很详细的英文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener noreferrer">CSRF防范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.youdzone.com/signature.html" target="_blank" rel="noopener noreferrer">signature<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cse.hkust.edu.hk/~raywong/comp170/notes/6-TheRSAAlgorithm.ppt" target="_blank" rel="noopener noreferrer">RSA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noopener noreferrer">TLS WIKI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://datatracker.ietf.org/doc/html/rfc5246#page-47" target="_blank" rel="noopener noreferrer">TLS 1.2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://datatracker.ietf.org/doc/html/rfc8446" target="_blank" rel="noopener noreferrer">TSL 1.3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a58d46cf.js" defer></script><script src="/assets/js/2.fe1eedfa.js" defer></script><script src="/assets/js/6.2fd028ab.js" defer></script>
  </body>
</html>
