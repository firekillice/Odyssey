# 闭包

## 作用域
* 作用域是指程序源代码中定义变量的区域。作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。
* 大多数现在程序设计语言都是采用静态作用域规则，而只有为数不多的几种语言采用动态作用域规则，包括APL、Snobol和Lisp的早期方言。
### 静态作用域规则
* 词法作用域(lexical scope)等同于静态作用域(static scope)。
* 所谓的词法作用域其实是指作用域在词法解析阶段既确定了，不会改变。
* 只有函数才能制造作用域结构，那么只要是代码，至少有一个作用域，即全局作用域。凡是代码中有函数，那么这个函数就构成另一个作用域。如果函数中还有函数，那么在这个作用域中就又可以诞生一个作用域，那么将这样的所有作用域列出来，可以有一个结构：函数内指向函数外的链式结构。
```
function foo() {
  console.log(a); // 2
}
function bar() {
  var a = 3;
  foo();
}
var a = 2;
bar();
```
上述代码对应的作用于分析如下，沿着语法树逆向追溯直到找到同名变量为止，否则会报错
![image](./assets/16ee9fbc027845d5.png)
### 不同语言的处理方式
* PHP 不允许函数访问非本作用域的变量
* JS、C语言允许访问函数作用域之外的变量
### 动态作用域
* 根据函数的调用栈进行追溯
## 