(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{648:function(s,e,a){"use strict";a.r(e);var t=a(26),r=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"k3s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k3s"}},[s._v("#")]),s._v(" K3S")]),s._v(" "),a("h3",{attrs:{id:"instll-一键安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#instll-一键安装"}},[s._v("#")]),s._v(" instll 一键安装")]),s._v(" "),a("ul",[a("li",[s._v("curl -sfL https://get.k3s.io | sh - 速度慢放弃")]),s._v(" "),a("li",[s._v("下载镜像")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget https://github.com/k3s-io/k3s/releases/download/v1.21.3%2Bk3s1/k3s-airgap-images-amd64.tar.gz \nmkdir -p /var/lib/rancher/k3s/agent/images/\ncp ./k3s-airgap-images-amd64.tar.gz /var/lib/rancher/k3s/agent/images/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#卸载"}},[s._v("#")]),s._v(" 卸载")]),s._v(" "),a("ul",[a("li",[s._v("k3s-uninstall.sh")])]),s._v(" "),a("h3",{attrs:{id:"关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭"}},[s._v("#")]),s._v(" 关闭")]),s._v(" "),a("ul",[a("li",[s._v("/usr/local/bin/k3s-killall.sh")])]),s._v(" "),a("h3",{attrs:{id:"配置地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置地址"}},[s._v("#")]),s._v(" 配置地址")]),s._v(" "),a("ul",[a("li",[s._v("/etc/systemd/system/k3s.service")])]),s._v(" "),a("h3",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[s._v("#")]),s._v(" 使用")]),s._v(" "),a("ul",[a("li",[s._v("alias kubectl='k3s kubectl'")]),s._v(" "),a("li",[s._v("查看使用的容器类型(Container Runtime Interface)")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("> crictl version\ncrictl version\nVersion:  0.1.0\nRuntimeName:  containerd\nRuntimeVersion:  v1.4.8-k3s1\nRuntimeApiVersion:  v1alpha2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"coredns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#coredns"}},[s._v("#")]),s._v(" coreDNS")]),s._v(" "),a("ul",[a("li",[s._v("kubectl get pod,svc -n kube-system")]),s._v(" "),a("li",[s._v("kubectl exec -it dig -- nslookup mongodb/redis(service name)")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Server:         10.43.0.10\nAddress:        10.43.0.10#53\n\nName:   mongodb.default.svc.cluster.local\nAddress: 10.43.68.176 (cluster IP 内部使用的无协议栈ip)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("kubectl exec -it dig -- nslookup www.baidu.com")]),s._v(" "),a("li",[s._v("pod域名生成规则："),a("svc-name",[s._v("."),a("namespace",[s._v(".svc.cluster.local")])],1)],1)]),s._v(" "),a("h3",{attrs:{id:"查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[s._v("#")]),s._v(" 查看")]),s._v(" "),a("ul",[a("li",[s._v("journalctl -xn | less")])]),s._v(" "),a("h3",{attrs:{id:"错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误"}},[s._v("#")]),s._v(" 错误")]),s._v(" "),a("ul",[a("li",[s._v('Failed to run kubelet" error="failed to run Kubelet: misconfiguration: kubelet cgroup driver: "cgroupfs" is different from docker cgroup driver: "systemd""')])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("原因是docker和k3s使用的Cgroup的方式不同,docker默认是用systemd，k3s使用cgroupfs\n优先修改docker的配置 /usr/lib/systemd/system/docker.service\nsystemctl daemon-reload \nsystemctl restart docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);