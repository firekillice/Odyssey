(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{409:function(e,s,a){e.exports=a.p+"assets/img/k8s-container-ip.357cc0d9.png"},410:function(e,s,a){e.exports=a.p+"assets/img/k8s-pod-container-ip.a9748664.png"},411:function(e,s,a){e.exports=a.p+"assets/img/k8s-framework.31870e07.png"},649:function(e,s,a){"use strict";a.r(s);var t=a(26),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"k8s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#k8s"}},[e._v("#")]),e._v(" k8s")]),e._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),t("ul",[t("li",[e._v("OS：centos7")]),e._v(" "),t("li",[e._v("关闭防火墙")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl disable firewalld\nsystemctl stop firewalld\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("安装软件")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yum install etcd kubernetes\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("修改配置，/etc/sysconfig/docker")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("OPTIONS='--selinux-enabled=false --insecure-registry gcr.io'\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("修改配置，/etc/kubernetes/apiserver，去掉ServiceAccount")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('KUBE_ADMISSION_CONTROL="--admission-control=NamespaceLifecycle,NamespaceExists,LimitRanger,SecurityContextDeny,ResourceQuota"\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ul",[t("li",[e._v("启动")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("systemctl start etcd\nsystemctl start docker\nsystemctl start kube-apiserver\nsystemctl start kube-controller-manager\nsystemctl start kube-scheduler\nsystemctl start kubelet\nsystemctl start kube-proxy\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br")])]),t("h3",{attrs:{id:"搭建样本服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#搭建样本服务"}},[e._v("#")]),e._v(" 搭建样本服务")]),e._v(" "),t("ul",[t("li",[e._v("kubectl create -f mysql-rc.yaml")]),e._v(" "),t("li",[e._v("kubectl delete -f mysql-rc.yaml")]),e._v(" "),t("li",[e._v("kubectl create -f mysql-svc.yaml (此处可写多个文件，可以使用网络文件)")]),e._v(" "),t("li",[e._v("kubectl apply -f mysql-rc.yaml (更新配置)")]),e._v(" "),t("li",[e._v("kubectl replace -f mysql-rc.yaml (替换配置)")]),e._v(" "),t("li",[e._v("kubectl describe pod mysql(pod的名字) 获取状态")]),e._v(" "),t("li",[e._v("kubectl describe all")])]),e._v(" "),t("h3",{attrs:{id:"命令使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令使用"}},[e._v("#")]),e._v(" 命令使用")]),e._v(" "),t("ul",[t("li",[e._v("kubectl get rc")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NAME      DESIRED   CURRENT   READY     AGE\nmysql     1         1         0         57s\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("kubectl get pods")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NAME          READY     STATUS              RESTARTS   AGE\nmysql-0hxxh   0/1       ContainerCreating   0          1m\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("kubectl get pods -o wide 显示更丰富的信息")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NAME                        READY     STATUS    RESTARTS   AGE       IP           NODE\nfrontend-3737371888-5q3qr   1/1       Running   0          20h       172.17.0.6   127.0.0.1\nmysql-jlrf5                 1/1       Running   0          21h       172.17.0.2   127.0.0.1\nmyweb-g9dk5                 1/1       Running   0          20h       172.17.0.5   127.0.0.1\nmyweb-k0nr3                 1/1       Running   0          20h       172.17.0.4   127.0.0.1\nmyweb-ltqdj                 1/1       Running   0          21h       172.17.0.3   127.0.0.1\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br")])]),t("ul",[t("li",[e._v("kubectl get svc")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NAME         CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nkubernetes   10.254.0.1      <none>        443/TCP    2h\nmysql        10.254.67.207   <none>        3306/TCP   20s\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("ul",[t("li",[e._v("kubectl get all")]),e._v(" "),t("li",[e._v("kubectl get pods --show-all")]),e._v(" "),t("li",[e._v("kubectl get nodes")]),e._v(" "),t("li",[e._v("kubectl  describe  node 127.0.0.1 获取对某个node的描述")]),e._v(" "),t("li",[e._v("kubectl logs -f myweb-ch5cm(pod的名字，在kubectl get pod中查看)")]),e._v(" "),t("li",[e._v("kubectl scale rc myweb --replicas=3  收缩")]),e._v(" "),t("li",[e._v("kubectl get endpoints")]),e._v(" "),t("li",[e._v("删除所有: kubectl delete svc(pods、nodes) --all")]),e._v(" "),t("li",[e._v("kubectl edit pod php-server-6f6f8bc8c-9hrfv 直接修改pod的配置")]),e._v(" "),t("li",[e._v("kubectl get secret 查看密钥")]),e._v(" "),t("li",[e._v("kubectl exec -it "),t("code",[e._v("kubectl get pods | grep mongo | awk '{print $1}'")]),e._v(" -- /bin/bash /docker-entrypoint-initdb.d/setup.sh (可以针对某个pod执行命令)")]),e._v(" "),t("li",[e._v("kubectl logs -f nginx-php-9d64cfb54-xc5tk(pod name ) nginx-game(container name)")]),e._v(" "),t("li",[e._v("curl localhost:10249/proxyMode (数据包的代理模式)")]),e._v(" "),t("li",[e._v("busybox是一个包含了nslookup,ping,wget等网络处理命令的Pod容器（不含curl命令），它的体积非常小，适合做一些容器内的网络调试。 kubectl run busybox -it --image=busybox --restart=Never --rm")]),e._v(" "),t("li",[e._v("kubectl get svc --namespace=kube-system 查看是否启用dns (注意kube-dns)")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("NAME             TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE\nkube-dns         ClusterIP      10.43.0.10     <none>        53/UDP,53/TCP,9153/TCP       10d\nmetrics-server   ClusterIP      10.43.29.48    <none>        443/TCP                      10d\ntraefik          LoadBalancer   10.43.211.41   10.70.4.207   80:31227/TCP,443:32709/TCP   10d\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[e._v("kubectl config view 查看k8s的配置")]),e._v(" "),t("li",[e._v("kubectl config view --minify --raw")]),e._v(" "),t("li",[e._v("kubectl config view --raw -o=jsonpath='{.clusters[0].cluster.certificate-authority-data}' | base64 --decode")]),e._v(" "),t("li",[e._v("kubectl --kubeconfig /etc/rancher/k3s/k3s.yaml get pods --all-namespaces")])]),e._v(" "),t("h3",{attrs:{id:"ingress"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ingress"}},[e._v("#")]),e._v(" ingress")]),e._v(" "),t("ul",[t("li",[e._v("kubectl describe svc traefik --namespace kube-system")]),e._v(" "),t("li",[e._v("kubectl get svc traefik --namespace kube-system -w")])]),e._v(" "),t("h3",{attrs:{id:"configmap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configmap"}},[e._v("#")]),e._v(" configMap")]),e._v(" "),t("ul",[t("li",[e._v("kubectl create configmap conf-d-game-conf --from-file ./conf.d/game.conf -o yaml > configmap.yaml")]),e._v(" "),t("li",[e._v("kubectl get cm")]),e._v(" "),t("li",[e._v("kubectl delete cm --all")])]),e._v(" "),t("h3",{attrs:{id:"安全"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安全"}},[e._v("#")]),e._v(" 安全")]),e._v(" "),t("ul",[t("li",[e._v("kubectl get secret 查看密钥")]),e._v(" "),t("li",[e._v("kubectl create secret docker-registry [$Reg_Secret] --docker-server=[$Registry] --docker-username=[$Username] --docker-password=[$Password] --docker-email=[$Email]")]),e._v(" "),t("li",[e._v("kubectl create secret docker-registry aliyun-secret --docker-server=registry.cn-hangzhou.aliyuncs.com --docker-username=3333333 --docker-password=1111111")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(" kubectl get secret\nNAME                  TYPE                                  DATA   AGE\ndefault-token-cl5qm   kubernetes.io/service-account-token   3      2d19h\naliyun-secret         kubernetes.io/dockerconfigjson        1      34s\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br")])]),t("ul",[t("li",[e._v("SA: service accounts")]),e._v(" "),t("li",[e._v("kubectl get sa")])]),e._v(" "),t("h4",{attrs:{id:"添加私有镜像仓库密钥到k8s中-使用新的sa方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加私有镜像仓库密钥到k8s中-使用新的sa方式"}},[e._v("#")]),e._v(" 添加私有镜像仓库密钥到k8s中(使用新的sa方式)")]),e._v(" "),t("ul",[t("li",[e._v("kubectl create secret docker-registry "),t("strong",[e._v("aliyun-secret")]),e._v(" --docker-server=registry.cn-hangzhou.aliyuncs.com --docker-username=3333333 --docker-password=1111111(创建密钥)")]),e._v(" "),t("li",[e._v("kubectl create sa "),t("strong",[e._v("aliyun")]),e._v(" (创建新的SA)")]),e._v(" "),t("li",[e._v("kubectl patch serviceaccount "),t("strong",[e._v("aliyun")]),e._v(' -p \'{"imagePullSecrets": [{"name": "'),t("strong",[e._v("aliyun-secret")]),e._v("\"}]}' (密钥添加到指定的SA中)")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: php-server\n  labels:\n    name: php-server\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: php-server\n  template:\n    metadata:\n      labels:\n        app: php-server\n    spec:\n      serviceAccountName: aliyun\n      imagePullSecrets:\n        - name: aliyun-secret\n      containers:\n      - name: php-server\n        image: registry.cn-hangzhou.aliyuncs.com/sandstone/php:v-game-1.0.0\n        imagePullPolicy: Always\n        #imagePullPolicy: IfNotPresent\n        volumeMounts:\n        - mountPath: /var/www/html/\n          name: nginx-data\n        ports:\n        - containerPort: 9000\n      volumes:\n      - name: nginx-data\n        hostPath:\n         path: /root/k8s/html\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br"),t("span",{staticClass:"line-number"},[e._v("17")]),t("br"),t("span",{staticClass:"line-number"},[e._v("18")]),t("br"),t("span",{staticClass:"line-number"},[e._v("19")]),t("br"),t("span",{staticClass:"line-number"},[e._v("20")]),t("br"),t("span",{staticClass:"line-number"},[e._v("21")]),t("br"),t("span",{staticClass:"line-number"},[e._v("22")]),t("br"),t("span",{staticClass:"line-number"},[e._v("23")]),t("br"),t("span",{staticClass:"line-number"},[e._v("24")]),t("br"),t("span",{staticClass:"line-number"},[e._v("25")]),t("br"),t("span",{staticClass:"line-number"},[e._v("26")]),t("br"),t("span",{staticClass:"line-number"},[e._v("27")]),t("br"),t("span",{staticClass:"line-number"},[e._v("28")]),t("br"),t("span",{staticClass:"line-number"},[e._v("29")]),t("br"),t("span",{staticClass:"line-number"},[e._v("30")]),t("br"),t("span",{staticClass:"line-number"},[e._v("31")]),t("br"),t("span",{staticClass:"line-number"},[e._v("32")]),t("br"),t("span",{staticClass:"line-number"},[e._v("33")]),t("br")])]),t("h4",{attrs:{id:"添加私有镜像仓库密钥到k8s中-添加到dafault中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加私有镜像仓库密钥到k8s中-添加到dafault中"}},[e._v("#")]),e._v(" 添加私有镜像仓库密钥到k8s中(添加到dafault中)")]),e._v(" "),t("ul",[t("li",[e._v("kubectl create secret docker-registry "),t("strong",[e._v("aliyun-secret")]),e._v(" --docker-server=registry.cn-hangzhou.aliyuncs.com --docker-username=3333333 --docker-password=1111111")]),e._v(" "),t("li",[e._v('kubectl patch serviceaccount default -p \'{"imagePullSecrets": [{"name": "'),t("strong",[e._v("aliyun-secret")]),e._v("\"}]}'")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: php-server\n  labels:\n    name: php-server\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: php-server\n  template:\n    metadata:\n      labels:\n        app: php-server\n    spec:\n      imagePullSecrets:\n        - name: aliyun-secret\n      containers:\n      - name: php-server\n        image: registry.cn-hangzhou.aliyuncs.com/sandstone/php:v-game-1.0.0\n        imagePullPolicy: Always\n        #imagePullPolicy: IfNotPresent\n        volumeMounts:\n        - mountPath: /var/www/html/\n          name: nginx-data\n        ports:\n        - containerPort: 9000\n      volumes:\n      - name: nginx-data\n        hostPath:\n         path: /root/k8s/html\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br"),t("span",{staticClass:"line-number"},[e._v("17")]),t("br"),t("span",{staticClass:"line-number"},[e._v("18")]),t("br"),t("span",{staticClass:"line-number"},[e._v("19")]),t("br"),t("span",{staticClass:"line-number"},[e._v("20")]),t("br"),t("span",{staticClass:"line-number"},[e._v("21")]),t("br"),t("span",{staticClass:"line-number"},[e._v("22")]),t("br"),t("span",{staticClass:"line-number"},[e._v("23")]),t("br"),t("span",{staticClass:"line-number"},[e._v("24")]),t("br"),t("span",{staticClass:"line-number"},[e._v("25")]),t("br"),t("span",{staticClass:"line-number"},[e._v("26")]),t("br"),t("span",{staticClass:"line-number"},[e._v("27")]),t("br"),t("span",{staticClass:"line-number"},[e._v("28")]),t("br"),t("span",{staticClass:"line-number"},[e._v("29")]),t("br"),t("span",{staticClass:"line-number"},[e._v("30")]),t("br"),t("span",{staticClass:"line-number"},[e._v("31")]),t("br"),t("span",{staticClass:"line-number"},[e._v("32")]),t("br")])]),t("h3",{attrs:{id:"生产效率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生产效率"}},[e._v("#")]),e._v(" 生产效率")]),e._v(" "),t("ul",[t("li",[e._v("shell自动补全")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('source <(kubectl completion bash) # 在 bash 中设置当前 shell 的自动补全，要先安装 bash-completion 包。\necho "source <(kubectl completion bash)" >> ~/.bashrc # 在您的 bash shell 中永久的添加自动补全\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h3",{attrs:{id:"stack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stack"}},[e._v("#")]),e._v(" stack")]),e._v(" "),t("h4",{attrs:{id:"flannel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#flannel"}},[e._v("#")]),e._v(" Flannel")]),e._v(" "),t("ul",[t("li",[e._v("Flannel是CoreOS团队针对Kubernetes设计的一个网络规划服务，简单来说，它的功能是让集群中的不同节点主机创建的Docker容器都具有全集群唯一的虚拟IP地址。")])]),e._v(" "),t("h4",{attrs:{id:"network"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#network"}},[e._v("#")]),e._v(" network")]),e._v(" "),t("ul",[t("li",[e._v("docker支持4类网络模式， host、container、none、bridge")]),e._v(" "),t("li",[e._v("在kubernetes管理模式下，网络使用bridge模式")])]),e._v(" "),t("h4",{attrs:{id:"理解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#理解"}},[e._v("#")]),e._v(" 理解")]),e._v(" "),t("ul",[t("li",[e._v("网桥 路由 veth iptables 共同构成了kubenetes的网络")]),e._v(" "),t("li",[e._v("同一个node同一个pod的ip "),t("br"),e._v(" "),t("img",{attrs:{src:a(409),alt:"node-1pod-container-ip"}})]),e._v(" "),t("li",[e._v("同一个node多个pod的ip"),t("br"),t("img",{attrs:{src:a(410),alt:"node-2pod-container-ip"}})]),e._v(" "),t("li",[e._v("架构 "),t("img",{attrs:{src:a(411),alt:"基本结构"}})])]),e._v(" "),t("h3",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[e._v("#")]),e._v(" 问题")]),e._v(" "),t("ul",[t("li",[e._v("错误：docker-ce conflicts with 2:docker-1.13.1-74.git6e3bb8e.el7.centos.x86_64\nError: docker-ce-cli conflicts with 2:docker-1.13.1-208.git7d71120.el7_9.x86_64")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(" yum remove -y docker-ce.x86_64\n yum remove -y docker-ce-cli.x86_64\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("open /etc/docker/certs.d/registry.access.redhat.com/redhat-ca.crt: no such file or directory")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("yum install *rhsm* -y\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("wget http://mirror.centos.org/centos/7/os/x86_64/Packages/python-rhsm-certificates-1.19.10-1.el7_4.x86_64.rpm rpm2cpio python-rhsm-certificates-1.19.10-1.el7_4.x86_64.rpm | cpio -iv --to-stdout ./etc/rhsm/ca/redhat-uep.pem | tee /etc/rhsm/ca/redhat-uep.pem\ndocker pull registry.access.redhat.com/rhel7/pod-infrastructure:latest\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("ul",[t("li",[e._v("The range of valid ports is 30000-32767")]),e._v(" "),t("li",[e._v("在同一个pod内启动的container，端口不能冲突")]),e._v(" "),t("li",[e._v("如果看不到错误日志，可能是进程被放到后台运行了，没有任何报错出来，啊啊啊啊啊啊啊，教训啊")]),e._v(" "),t("li",[e._v("如果没有办法来查看错误，则使用其他命令进入到容器中，然后手动执行进程的启动，观察错误\\")]),e._v(" "),t("li",[e._v("..2021_08_17_05_00_25.674450089 类似这样的目录，ls -la可以看到")]),e._v(" "),t("li",[e._v("configMap的动态更新需要一定的时间")])])])}),[],!1,null,null,null);s.default=n.exports}}]);