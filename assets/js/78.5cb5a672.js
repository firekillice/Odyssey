(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{660:function(s,n,a){"use strict";a.r(n);var e=a(26),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"系统调用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统调用"}},[s._v("#")]),s._v(" 系统调用")]),s._v(" "),a("ul",[a("li",[s._v("System calls are the primary mechanism by which user-space programs interact with the Linux kernel.")])]),s._v(" "),a("h2",{attrs:{id:"陷入到内核的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#陷入到内核的方式"}},[s._v("#")]),s._v(" 陷入到内核的方式")]),s._v(" "),a("ul",[a("li",[s._v("x86 的系统调用实现经历了 int / iret 到 sysenter / sysexit 再到 syscall / sysret 的演变")])]),s._v(" "),a("h4",{attrs:{id:"中断的方式-int-0x80"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中断的方式-int-0x80"}},[s._v("#")]),s._v(" 中断的方式 int 0x80")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('.data\n    s:\n        .ascii "hello world\\n"\n        len = . - s\n.text\n    .global _start\n    _start:\n\n        movl $4, %eax   /* write system call number */\n        movl $1, %ebx   /* stdout */\n        movl $s, %ecx   /* the data to print */\n        movl $len, %edx /* length of the buffer */\n        int $0x80\n\n        movl $1, %eax   /* exit system call number */\n        movl $0, %ebx   /* exit status */\n        int $0x80\n------------------------------------------------------------------------------------------------------------\nas -o main.o main.S\nld -o main.out main.o\n./main.out\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"syscall"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#syscall"}},[s._v("#")]),s._v(" syscall")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("int\nmain() {\nexit(0);\n}\n--------------------------------------------------------------------------------------------------------------\ngdb ./a.out\ndisas *_exit\n\n    0x00007ffff7ad2bd0 <+0>:     movslq %edi,%rdx\n   0x00007ffff7ad2bd3 <+3>:     mov    0x301276(%rip),%r10        # 0x7ffff7dd3e50\n   0x00007ffff7ad2bda <+10>:    mov    $0xe7,%r9d\n   0x00007ffff7ad2be0 <+16>:    mov    $0x3c,%r8d\n   0x00007ffff7ad2be6 <+22>:    jmp    0x7ffff7ad2c01 <_exit+49>\n   0x00007ffff7ad2be8 <+24>:    nopl   0x0(%rax,%rax,1)\n   0x00007ffff7ad2bf0 <+32>:    mov    %rdx,%rdi\n   0x00007ffff7ad2bf3 <+35>:    mov    %r8d,%eax\n   0x00007ffff7ad2bf6 <+38>:    syscall \n   0x00007ffff7ad2bf8 <+40>:    cmp    $0xfffffffffffff000,%rax\n   0x00007ffff7ad2bfe <+46>:    ja     0x7ffff7ad2c1b <_exit+75>\n   0x00007ffff7ad2c00 <+48>:    hlt    \n   0x00007ffff7ad2c01 <+49>:    mov    %rdx,%rdi\n   0x00007ffff7ad2c04 <+52>:    mov    %r9d,%eax\n   0x00007ffff7ad2c07 <+55>:    syscall \n   0x00007ffff7ad2c09 <+57>:    cmp    $0xfffffffffffff000,%rax\n   0x00007ffff7ad2c0f <+63>:    jbe    0x7ffff7ad2bf0 <_exit+32>\n   0x00007ffff7ad2c11 <+65>:    mov    %eax,%esi\n   0x00007ffff7ad2c13 <+67>:    neg    %esi\n   0x00007ffff7ad2c15 <+69>:    mov    %esi,%fs:(%r10)\n   0x00007ffff7ad2c19 <+73>:    jmp    0x7ffff7ad2bf0 <_exit+32>\n   0x00007ffff7ad2c1b <+75>:    mov    %eax,%esi\n   0x00007ffff7ad2c1d <+77>:    neg    %esi\n   0x00007ffff7ad2c1f <+79>:    mov    %esi,%fs:(%r10)\n   0x00007ffff7ad2c23 <+83>:    jmp    0x7ffff7ad2c00 <_exit+48>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h2",{attrs:{id:"查看系统调用编号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看系统调用编号"}},[s._v("#")]),s._v(" 查看系统调用编号")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("less /usr/include/asm/unistd_64.h   \n#ifndef _ASM_X86_UNISTD_64_H\n#define _ASM_X86_UNISTD_64_H 1\n\n#define __NR_read 0\n#define __NR_write 1\n#define __NR_open 2\n#define __NR_close 3\n#define __NR_stat 4\n#define __NR_fstat 5\n#define __NR_lstat 6\n#define __NR_poll 7\n#define __NR_lseek 8\n#define __NR_mmap 9\n#define __NR_mprotect 10\n#define __NR_munmap 11\n#define __NR_brk 12\n#define __NR_rt_sigaction 13\n#define __NR_rt_sigprocmask 14\n#define __NR_rt_sigreturn 15\n#define __NR_ioctl 16\n#define __NR_pread64 17\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);